var EntryData=function(){function t(){this.team=[];this.filtering="";this.offset=0;this.listTemplate=Cmn.dir+"/mus/filterResult.mustache";this.filterTemplate=Cmn.dir+"/mus/filterTeam.mustache";this.target={select:"#teamFilter",result:"#landscape-result"};this.flg={start:false};var t=this;t.getEntryData();setInterval(function(){if(t.flg.start===false)return false;t.flg.start=false;t.getEntryData()},1e4);setInterval(function(){if(t.elem===void 0||t.flg.start===false)return false;for(var e=0,a=t.elem.length;e<a;e++){var r=$(t.elem[e]),i=r.data("created"),n=t.getTimeDiff(i);r.find(".filterResult-date").text(n)}},3e4);$(document).on("change",t.target.select,function(){t.elem.removeClass("hidden");var e=$(this).val();if(e==="0"){t.filtering=""}else{t.filtering=e;t.elem.filter(function(t){var a=$(this),r=a.data("team");if(r!==e)a.addClass("hidden")})}});setInterval(function(){$.ajax({url:Cmn.dir+"/deleteData",dataType:"json",type:"GET",success:function(e){if(e.status==="success"){t.elem.filter(function(a){var r=$(this),i=String(r.data("id")),n=e.list.indexOf(i);if(n>-1){r.remove();t.elem.splice(a,1)}})}},error:function(){},complete:function(){}})},6e5)}t.prototype.getEntryData=function(){var t=this;$.ajax({url:Cmn.dir+"/allData?offset="+this.offset,dataType:"json",type:"GET",success:function(e){switch(e.status){case"success":t.setDataList(e.data);t.setTeam(e.data);t.offset=e.count;break}t.flg.start=true},error:function(){},complete:function(){}})};t.prototype.setDataList=function(t){var e=this;var a="";$.get(this.listTemplate,function(r){for(var i=t.length-1;i>=0;i--){var n=t[i];n.uploads=Cmn.dir+"/uploads";n.time=e.getTimeDiff(n.created_at);if(e.filtering===n.team)n.hidden=" hidden";a+=Mustache.render(r,n)}$(e.target.result).prepend(a);e.elem=$(".filterResult")})};t.prototype.setTeam=function(t){var e=this;$.get(this.filterTemplate,function(a){var r="";for(var i=0,n=t.length;i<n;i++){var s=t[i],f=e.team.indexOf(s.team);if(f>-1)continue;e.team.push(s.team);r+=Mustache.render(a,s)}$(e.target.select).append(r)})};t.prototype.getTimeDiff=function(t){var e=(new Date).getTime(),a=t.replace(/-/g,"/"),r=new Date(a).getTime(),i=e-r,n=i/1e3>>0;if(n<60){return n+"秒前"}n=n/60>>0;if(n<60){return n+"分前"}n=n/60>>0;if(n<24){return n+"時間前"}n=n/24>>0;if(n<365){return n+"日前"}n=n/365>>0;return n+"年以上前"};return t}();new EntryData;