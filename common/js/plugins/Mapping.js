var Register;var Mapping=function(){function e(){this.h=0;this.area={mapH:0,editH:0};this.mapOption={zoom:18,center:new google.maps.LatLng(37.397983,140.388412),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:true,scaleControl:true,panControl:true,zoomControl:false,mapTypeControl:false,streetViewControl:true,draggable:true};this.target={areaMap:"#areaMap",areaEdit:".jsLoad-EditArea",btnEdit:"#btnEdit",form:"#areaForm"};this.flg={edit:false,drag:true,root:true};this.cls={edit:"onEdit"};this.form={val:".jsChange-Edit",lat:"#map-lat",lng:"#map-lng",geoFlg:"#mapGeo"};var e=this;e.h=Frame.getBrowserHeight();e.area.mapH=e.h*.3;e.area.editH=e.h-e.area.mapH;$(e.target.areaMap).css({height:e.h});$(e.target.areaEdit).css({height:e.area.editH});$.getJSON(Cmn.dir+"/data/settings.json",function(t){e.settings=t}).done(function(){var t=$(e.target.areaMap).get(0);e.areaMap=new google.maps.Map(t,e.mapOption);e.getMyPosition("load")});$(e.target.btnEdit).on("touchend",function(t){t.preventDefault();var a=$(this).hasClass(e.cls.edit);$(e.target.form).removeClass("editWrite").addClass("newWrite");if(a===false){e.openBtn()}else{e.closeBtn()}})}e.prototype.getMyPosition=function(e){if(e===void 0){e=null}var t=this,a=0;t.myPosition=window.navigator.geolocation.watchPosition(i,o,{enableHighAccuracy:true,maximumAge:3e4,timeout:27e3});function i(i){a=0;t.myGeo=i;var o=new google.maps.LatLng(i.coords.latitude,i.coords.longitude),r={path:google.maps.SymbolPath.CIRCLE,scale:6,fillColor:t.settings.subColor,fillOpacity:1,strokeColor:"#ffffff",strokeOpacity:1,strokeWeight:1};if(t.myMarker===void 0){t.myMarker=new google.maps.Marker({icon:r,map:t.areaMap})}if(t.myDiffCircle===void 0){t.myDiffCircle=new google.maps.Circle({center:o,radius:i.coords.accuracy,strokeColor:t.settings.mainColor,strokeOpacity:.8,strokeWeight:1,fillColor:t.settings.mainColor,fillOpacity:.2,map:t.areaMap})}else{t.myDiffCircle.setCenter(o);t.myDiffCircle.setRadius(i.coords.accuracy)}t.myMarker.setPosition(o);var s=t.myMarker.getVisible(),n=t.myDiffCircle.getVisible();if(s===false)t.myMarker.setVisible(true);if(n===false)t.myDiffCircle.setVisible(true);if(t.flg.edit===true){t.myMarker.setVisible(false);t.myDiffCircle.setVisible(false)}else{t.areaMap.panTo(o)}if(e==="load"){$("#message").removeClass("show");$("#mesage-text").html("")}if(t.flg.root===true){t.flg.root=false;setTimeout(function(){t.flg.root=true;var e=$("#form_team").val(),a=t.myGeo.coords.latitude,i=t.myGeo.coords.longitude;$.ajax({url:Cmn.dir+"/root",type:"POST",dataType:"json",data:{team:e,lat:a,lng:i},success:function(e){},error:function(){},complete:function(){}})},18e4)}}function o(e){a++;console.log(e,a);t.flg.drag=false;switch(true){case a>3:break;default:t.getMyPosition();break}}};e.prototype.clearPosition=function(){navigator.geolocation.clearWatch(this.myPosition);this.myMarker.setVisible(false);this.myDiffCircle.setVisible(false)};e.prototype.openBtn=function(e){if(e===void 0){e=[]}$(this.target.areaMap).css({height:this.area.mapH});this.clearPosition();this.flg.edit=true;this.flg.drag=false;$(this.target.btnEdit).addClass(this.cls.edit);this.editMapping(e)};e.prototype.closeBtn=function(){$(this.target.areaMap).css({height:this.h});$(this.target.btnEdit).removeClass(this.cls.edit);Register.removeForm();if(this.editMarker!==void 0){google.maps.event.clearListeners(this.editMarker,"dragend");this.editMarker.setMap(null)}this.flg.edit=false;this.flg.drag=true;var e=this.getLatLng();this.resizeMap(e);this.getMyPosition()};e.prototype.resizeMap=function(e){var t=this;$(this.target.areaMap).on(EVENTS.animation.end,function(){google.maps.event.trigger(t.areaMap,"resize");t.areaMap.setCenter(e.pos);$(t.target.areaMap).off(EVENTS.animation.end)})};e.prototype.getLatLng=function(e){if(e===void 0){e=[]}var t=e[0]===void 0?this.myGeo.coords.latitude:e[0],a=e[1]===void 0?this.myGeo.coords.longitude:e[1];return{lat:t,lng:a,pos:new google.maps.LatLng(t,a)}};e.prototype.editMapping=function(e){var t=this;var a=this.getLatLng(e);this.editMarker=new google.maps.Marker({position:a.pos,draggable:true,map:this.areaMap});google.maps.event.addListener(this.editMarker,"dragend",function(e){var a=e.latLng.lat(),i=e.latLng.lng();$(t.form.lat).val(a);$(t.form.lng).val(i);$(t.form.geoFlg).val("true")});this.resizeMap(a);$(this.form.lat).val(a.lat);$(this.form.lng).val(a.lng)};return e}();var Maps;jQuery(function(e){Maps=new Mapping});