/*******************************************************************************
 * Google Map
 *
 * Copyright (c) 2015. Code for KORIYAMA. All Rights Reserved.
 *
 * @author: Nobuyuki Kondo
 * @uri: http://koriyama.io/
 * @version: 1.0
 ******************************************************************************/
///<reference path="../../dts/libs/jquery.d.ts" />
///<reference path="../../dts/libs/googlemap.d.ts"/>
///<reference path="../../dts/libs/custom.d.ts"/>
///<reference path="../assets/Cmn.ts"/>
///<reference path="../assets/Events.ts"/>
var Register;
var Mapping = (function () {
    function Mapping() {
        // 領域
        this.h = 0;
        this.area = {
            mapH: 0,
            editH: 0
        };
        this.mapOption = {
            zoom: 18,
            center: new google.maps.LatLng(37.397983, 140.388412),
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            scrollwheel: true,
            scaleControl: true,
            panControl: true,
            zoomControl: false,
            mapTypeControl: false,
            streetViewControl: true,
            draggable: true
        };
        // ターゲット
        this.target = {
            areaMap: '#areaMap',
            areaEdit: '.jsLoad-EditArea',
            btnEdit: '#btnEdit',
            form: '#areaForm'
        };
        // フラグ
        this.flg = {
            edit: false,
            drag: true,
            root: true
        };
        // クラス名
        this.cls = {
            edit: 'onEdit'
        };
        // Form
        this.form = {
            val: '.jsChange-Edit',
            lat: '#map-lat',
            lng: '#map-lng',
            geoFlg: '#mapGeo'
        };
        var _t = this;
        _t.h = Frame.getBrowserHeight();
        _t.area.mapH = _t.h * 0.3;
        _t.area.editH = _t.h - _t.area.mapH;
        $(_t.target.areaMap).css({ height: _t.h });
        $(_t.target.areaEdit).css({ height: _t.area.editH });
        $.getJSON(Cmn.dir + '/data/settings.json', function (json) {
            _t.settings = json;
        }).done(function () {
            // マップの描写
            var div = $(_t.target.areaMap).get(0);
            _t.areaMap = new google.maps.Map(div, _t.mapOption);
            // 現在地の取得
            _t.getMyPosition('load');
        });
        // Editボタン押下
        $(_t.target.btnEdit).on('touchend', function (e) {
            e.preventDefault();
            var isClose = $(this).hasClass(_t.cls.edit);
            $(_t.target.form).removeClass('editWrite').addClass('newWrite');
            if (isClose === false) {
                _t.openBtn();
            }
            else {
                _t.closeBtn();
            }
        });
    }
    /**
     * 現在地の観測
     */
    Mapping.prototype.getMyPosition = function (mode) {
        if (mode === void 0) { mode = null; }
        var _t = this, errorCount = 0;
        _t.myPosition = window.navigator.geolocation.watchPosition(positionSuccess, positionError, {
            enableHighAccuracy: true,
            maximumAge: 30000,
            timeout: 27000
        });
        /**
         * 位置情報の成功
         * @param geo
         */
        function positionSuccess(geo) {
            errorCount = 0;
            _t.myGeo = geo;
            // マーカーのセット
            var currentPosition = new google.maps.LatLng(geo.coords.latitude, geo.coords.longitude), icon = {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 6,
                fillColor: _t.settings.subColor,
                fillOpacity: 1,
                strokeColor: '#ffffff',
                strokeOpacity: 1,
                strokeWeight: 1
            };
            if (_t.myMarker === void 0) {
                _t.myMarker = new google.maps.Marker({
                    icon: icon,
                    map: _t.areaMap
                });
            }
            // 誤差サークルのセット
            if (_t.myDiffCircle === void 0) {
                _t.myDiffCircle = new google.maps.Circle({
                    center: currentPosition,
                    radius: geo.coords.accuracy,
                    strokeColor: _t.settings.mainColor,
                    strokeOpacity: 0.8,
                    strokeWeight: 1,
                    fillColor: _t.settings.mainColor,
                    fillOpacity: 0.2,
                    map: _t.areaMap
                });
            }
            else {
                _t.myDiffCircle.setCenter(currentPosition);
                _t.myDiffCircle.setRadius(geo.coords.accuracy);
            }
            _t.myMarker.setPosition(currentPosition);
            var isM = _t.myMarker.getVisible(), isC = _t.myDiffCircle.getVisible();
            if (isM === false)
                _t.myMarker.setVisible(true);
            if (isC === false)
                _t.myDiffCircle.setVisible(true);
            if (_t.flg.edit === true) {
                _t.myMarker.setVisible(false);
                _t.myDiffCircle.setVisible(false);
            }
            else {
                _t.areaMap.panTo(currentPosition);
            }
            if (mode === 'load') {
                $('#message').removeClass('show');
                $('#mesage-text').html('');
            }
            // 3分毎に現在地をDBに格納
            if (_t.flg.root === true) {
                _t.flg.root = false;
                setTimeout(function () {
                    _t.flg.root = true;
                    var team = $('#form_team').val(), lat = _t.myGeo.coords.latitude, lng = _t.myGeo.coords.longitude;
                    $.ajax({
                        url: Cmn.dir + '/root',
                        type: 'POST',
                        dataType: 'json',
                        data: {
                            team: team,
                            lat: lat,
                            lng: lng
                        },
                        success: function (res) {
                        },
                        error: function () {
                        },
                        complete: function () {
                        }
                    });
                }, 180000); // 1000ms * 60sec * 3分 = 180000
            }
        }
        /**
         * 取得エラー(3回連続の場合画面ロック)
         * @param error
         */
        function positionError(error) {
            errorCount++;
            console.log(error, errorCount);
            _t.flg.drag = false;
            switch (true) {
                case (errorCount > 3):
                    break;
                default:
                    // 規定エラー回数以内の場合は再度取得にチャレンジ
                    _t.getMyPosition();
                    break;
            }
        }
    };
    /**
     * 観測を停止
     */
    Mapping.prototype.clearPosition = function () {
        navigator.geolocation.clearWatch(this.myPosition);
        this.myMarker.setVisible(false);
        this.myDiffCircle.setVisible(false);
    };
    /**
     * 登録・編集画面を表示
     * @param ltln
     */
    Mapping.prototype.openBtn = function (ltln) {
        if (ltln === void 0) { ltln = []; }
        $(this.target.areaMap).css({ height: this.area.mapH });
        this.clearPosition();
        // フォームエリアの時はフラグを立てる
        this.flg.edit = true;
        this.flg.drag = false;
        $(this.target.btnEdit).addClass(this.cls.edit);
        this.editMapping(ltln);
    };
    /**
     * 登録・編集画面を非表示
     */
    Mapping.prototype.closeBtn = function () {
        $(this.target.areaMap).css({ height: this.h });
        $(this.target.btnEdit).removeClass(this.cls.edit);
        Register.removeForm();
        // マーカー削除
        if (this.editMarker !== void 0) {
            google.maps.event.clearListeners(this.editMarker, 'dragend');
            this.editMarker.setMap(null);
        }
        // フラグのセット
        this.flg.edit = false;
        this.flg.drag = true;
        // 再描写
        var latlng = this.getLatLng();
        this.resizeMap(latlng);
        this.getMyPosition();
    };
    /**
     * アニメーションが終了したらマップの位置を調整
     * @param latlng
     */
    Mapping.prototype.resizeMap = function (latlng) {
        var _this = this;
        $(this.target.areaMap).on(EVENTS.animation.end, function () {
            google.maps.event.trigger(_this.areaMap, 'resize');
            _this.areaMap.setCenter(latlng.pos);
            $(_this.target.areaMap).off(EVENTS.animation.end);
        });
    };
    /**
     * 位置情報を返す
     * @param ltln
     * @returns {google.maps.LatLng}
     */
    Mapping.prototype.getLatLng = function (ltln) {
        if (ltln === void 0) { ltln = []; }
        var lat = (ltln[0] === void 0) ? this.myGeo.coords.latitude : ltln[0], lng = (ltln[1] === void 0) ? this.myGeo.coords.longitude : ltln[1];
        return {
            lat: lat,
            lng: lng,
            pos: new google.maps.LatLng(lat, lng)
        };
    };
    /**
     * 登録・編集画面でのピン位置
     * @param ltln
     */
    Mapping.prototype.editMapping = function (ltln) {
        var _this = this;
        var latlng = this.getLatLng(ltln);
        this.editMarker = new google.maps.Marker({
            position: latlng.pos,
            draggable: true,
            map: this.areaMap
        });
        // マーカーを動かした場合は座標をセット
        google.maps.event.addListener(this.editMarker, 'dragend', function (evt) {
            var lat = evt.latLng.lat(), lng = evt.latLng.lng();
            $(_this.form.lat).val(lat);
            $(_this.form.lng).val(lng);
            $(_this.form.geoFlg).val('true');
        });
        //this.areaMap.panTo(latlng.pos);
        this.resizeMap(latlng);
        $(this.form.lat).val(latlng.lat);
        $(this.form.lng).val(latlng.lng);
    };
    return Mapping;
})();
var Maps;
jQuery(function ($) {
    Maps = new Mapping();
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBsdWdpbnMvTWFwcGluZy50cyJdLCJuYW1lcyI6WyJNYXBwaW5nIiwiTWFwcGluZy5jb25zdHJ1Y3RvciIsIk1hcHBpbmcuZ2V0TXlQb3NpdGlvbiIsIk1hcHBpbmcuZ2V0TXlQb3NpdGlvbi5wb3NpdGlvblN1Y2Nlc3MiLCJNYXBwaW5nLmdldE15UG9zaXRpb24ucG9zaXRpb25FcnJvciIsIk1hcHBpbmcuY2xlYXJQb3NpdGlvbiIsIk1hcHBpbmcub3BlbkJ0biIsIk1hcHBpbmcuY2xvc2VCdG4iLCJNYXBwaW5nLnJlc2l6ZU1hcCIsIk1hcHBpbmcuZ2V0TGF0TG5nIiwiTWFwcGluZy5lZGl0TWFwcGluZyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O2dGQVFnRjtBQUNoRixrREFBa0Q7QUFDbEQsb0RBQW9EO0FBQ3BELGlEQUFpRDtBQUNqRCx1Q0FBdUM7QUFDdkMsMENBQTBDO0FBRTFDLElBQUksUUFBWSxDQUFDO0FBRWpCLElBQU0sT0FBTztJQTREWEEsU0E1RElBLE9BQU9BO1FBQ1hDLEtBQUtBO1FBQ0dBLE1BQUNBLEdBQVVBLENBQUNBLENBQUNBO1FBQ2JBLFNBQUlBLEdBQUdBO1lBQ2JBLElBQUlBLEVBQUdBLENBQUNBO1lBQ1JBLEtBQUtBLEVBQUVBLENBQUNBO1NBQ1RBLENBQUNBO1FBUU1BLGNBQVNBLEdBQUdBO1lBQ2xCQSxJQUFJQSxFQUFlQSxFQUFFQTtZQUNyQkEsTUFBTUEsRUFBYUEsSUFBSUEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsRUFBRUEsVUFBVUEsQ0FBQ0E7WUFDaEVBLFNBQVNBLEVBQVVBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLE9BQU9BO1lBQ2hEQSxXQUFXQSxFQUFRQSxJQUFJQTtZQUN2QkEsWUFBWUEsRUFBT0EsSUFBSUE7WUFDdkJBLFVBQVVBLEVBQVNBLElBQUlBO1lBQ3ZCQSxXQUFXQSxFQUFRQSxLQUFLQTtZQUN4QkEsY0FBY0EsRUFBS0EsS0FBS0E7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QUVBLENBQUNBO1FBRXRCQSxBQUNBQSxTQURTQTtRQUNUQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxLQUFLQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMvQkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsY0FBY0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsRUFBRUEsU0FBU0EsQ0FBQ0EsQ0FBQ0E7WUFDN0RBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQy9CQSxDQUFDQTtRQUVEQSxBQUNBQSxVQURVQTtRQUNWQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQTtRQUN0QkEsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFFckJBLEFBQ0FBLE1BRE1BO1lBQ0ZBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLEVBQUVBLENBQUNBO1FBQzlCQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUN2QkEsSUFBSUEsQ0FBQ0EsYUFBYUEsRUFBRUEsQ0FBQ0E7SUFDdkJBLENBQUNBO0lBRURQOzs7T0FHR0E7SUFDSEEsMkJBQVNBLEdBQVRBLFVBQVVBLE1BQU1BO1FBQWhCUSxpQkFNQ0E7UUFMQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsR0FBR0EsRUFBRUE7WUFDOUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLENBQUNBLEtBQUlBLENBQUNBLE9BQU9BLEVBQUVBLFFBQVFBLENBQUNBLENBQUNBO1lBQ2xEQSxLQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxTQUFTQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUNuQ0EsQ0FBQ0EsQ0FBQ0EsS0FBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDbkRBLENBQUNBLENBQUNBLENBQUNBO0lBQ0xBLENBQUNBO0lBR0RSOzs7O09BSUdBO0lBQ0hBLDJCQUFTQSxHQUFUQSxVQUFVQSxJQUFTQTtRQUFUUyxvQkFBU0EsR0FBVEEsU0FBU0E7UUFDakJBLElBQUlBLEdBQUdBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLEtBQUtBLENBQUNBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLEVBQ25FQSxHQUFHQSxHQUFHQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxLQUFLQSxLQUFLQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUVyRUEsTUFBTUEsQ0FBQ0E7WUFDTEEsR0FBR0EsRUFBRUEsR0FBR0E7WUFDUkEsR0FBR0EsRUFBRUEsR0FBR0E7WUFDUkEsR0FBR0EsRUFBRUEsSUFBSUEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsRUFBRUEsR0FBR0EsQ0FBQ0E7U0FDdENBLENBQUNBO0lBQ0pBLENBQUNBO0lBRURUOzs7T0FHR0E7SUFDSEEsNkJBQVdBLEdBQVhBLFVBQVlBLElBQUlBO1FBQWhCVSxpQkF5QkNBO1FBeEJDQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUVsQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsSUFBSUEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7WUFDdkNBLFFBQVFBLEVBQUdBLE1BQU1BLENBQUNBLEdBQUdBO1lBQ3JCQSxTQUFTQSxFQUFFQSxJQUFJQTtZQUNmQSxHQUFHQSxFQUFRQSxJQUFJQSxDQUFDQSxPQUFPQTtTQUN4QkEsQ0FBQ0EsQ0FBQ0E7UUFHSEEsQUFDQUEscUJBRHFCQTtRQUNyQkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsRUFBRUEsU0FBU0EsRUFBRUEsVUFBQ0EsR0FBR0E7WUFDNURBLElBQUlBLEdBQUdBLEdBQUdBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLEVBQUVBLEVBQ3hCQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQTtZQUV6QkEsQ0FBQ0EsQ0FBQ0EsS0FBSUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7WUFDMUJBLENBQUNBLENBQUNBLEtBQUlBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1lBQzFCQSxDQUFDQSxDQUFDQSxLQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUNsQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFFSEEsQUFDQUEsaUNBRGlDQTtRQUNqQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFFdkJBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO1FBQ2pDQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUNuQ0EsQ0FBQ0E7SUFDSFYsY0FBQ0E7QUFBREEsQ0FuVkEsQUFtVkNBLElBQUE7QUFFRCxJQUFJLElBQUksQ0FBQztBQUNULE1BQU0sQ0FBQyxVQUFVLENBQUM7SUFDaEIsSUFBSSxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoicGx1Z2lucy9NYXBwaW5nLmpzIiwic291cmNlUm9vdCI6Ii4uL193cy90eXBlc2NyaXB0LyIsInNvdXJjZXNDb250ZW50IjpbIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXG4gKiBHb29nbGUgTWFwXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LiBDb2RlIGZvciBLT1JJWUFNQS4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBAYXV0aG9yOiBOb2J1eXVraSBLb25kb1xuICogQHVyaTogaHR0cDovL2tvcml5YW1hLmlvL1xuICogQHZlcnNpb246IDEuMFxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL2R0cy9saWJzL2pxdWVyeS5kLnRzXCIgLz5cbi8vLzxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL2R0cy9saWJzL2dvb2dsZW1hcC5kLnRzXCIvPlxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vZHRzL2xpYnMvY3VzdG9tLmQudHNcIi8+XG4vLy88cmVmZXJlbmNlIHBhdGg9XCIuLi9hc3NldHMvQ21uLnRzXCIvPlxuLy8vPHJlZmVyZW5jZSBwYXRoPVwiLi4vYXNzZXRzL0V2ZW50cy50c1wiLz5cblxudmFyIFJlZ2lzdGVyOmFueTtcblxuY2xhc3MgTWFwcGluZyB7XG4gIC8vIOmgmOWfn1xuICBwcml2YXRlIGg6bnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBhcmVhID0ge1xuICAgIG1hcEggOiAwLFxuICAgIGVkaXRIOiAwXG4gIH07XG5cbiAgLy8g44Oe44OD44OX6Zai6YCjXG4gIHByaXZhdGUgYXJlYU1hcDphbnk7XG4gIHByaXZhdGUgbXlHZW86YW55O1xuICBwcml2YXRlIG15UG9zaXRpb246YW55O1xuICBwcml2YXRlIG15TWFya2VyOmFueTtcbiAgcHJpdmF0ZSBteURpZmZDaXJjbGU6YW55O1xuICBwcml2YXRlIG1hcE9wdGlvbiA9IHtcbiAgICB6b29tICAgICAgICAgICAgIDogMTgsXG4gICAgY2VudGVyICAgICAgICAgICA6IG5ldyBnb29nbGUubWFwcy5MYXRMbmcoMzcuMzk3OTgzLCAxNDAuMzg4NDEyKSwgICAgLy8g6YOh5bGx6aeFXG4gICAgbWFwVHlwZUlkICAgICAgICA6IGdvb2dsZS5tYXBzLk1hcFR5cGVJZC5ST0FETUFQLFxuICAgIHNjcm9sbHdoZWVsICAgICAgOiB0cnVlLFxuICAgIHNjYWxlQ29udHJvbCAgICAgOiB0cnVlLFxuICAgIHBhbkNvbnRyb2wgICAgICAgOiB0cnVlLFxuICAgIHpvb21Db250cm9sICAgICAgOiBmYWxzZSxcbiAgICBtYXBUeXBlQ29udHJvbCAgIDogZmFsc2UsXG4gICAgc3RyZWV0Vmlld0NvbnRyb2w6IHRydWUsXG4gICAgZHJhZ2dhYmxlICAgICAgICA6IHRydWVcbiAgfTtcblxuICBwcml2YXRlIGVkaXRNYXJrZXI6YW55O1xuXG4gIC8vIOOCv+ODvOOCsuODg+ODiFxuICBwcml2YXRlIHRhcmdldCA9IHtcbiAgICBhcmVhTWFwIDogJyNhcmVhTWFwJyxcbiAgICBhcmVhRWRpdDogJy5qc0xvYWQtRWRpdEFyZWEnLFxuICAgIGJ0bkVkaXQgOiAnI2J0bkVkaXQnLFxuICAgIGZvcm0gICAgOiAnI2FyZWFGb3JtJ1xuICB9O1xuXG4gIC8vIOODleODqeOCsFxuICBwcml2YXRlIGZsZyA9IHtcbiAgICBlZGl0OiBmYWxzZSxcbiAgICBkcmFnOiB0cnVlLFxuICAgIHJvb3Q6IHRydWVcbiAgfTtcblxuICAvLyDjgq/jg6njgrnlkI1cbiAgcHJpdmF0ZSBjbHMgPSB7XG4gICAgZWRpdDogJ29uRWRpdCdcbiAgfTtcblxuICAvLyBGb3JtXG4gIHByaXZhdGUgZm9ybSA9IHtcbiAgICB2YWw6ICcuanNDaGFuZ2UtRWRpdCcsXG4gICAgbGF0OiAnI21hcC1sYXQnLFxuICAgIGxuZzogJyNtYXAtbG5nJyxcbiAgICBnZW9GbGc6ICcjbWFwR2VvJ1xuICB9O1xuXG4gIC8vIOOBneOBruS7llxuICBwcml2YXRlIHNldHRpbmdzOmFueTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB2YXIgX3QgPSB0aGlzO1xuXG4gICAgX3QuaCA9IEZyYW1lLmdldEJyb3dzZXJIZWlnaHQoKTtcbiAgICBfdC5hcmVhLm1hcEggPSBfdC5oICogMC4zO1xuICAgIF90LmFyZWEuZWRpdEggPSBfdC5oIC0gX3QuYXJlYS5tYXBIO1xuXG4gICAgJChfdC50YXJnZXQuYXJlYU1hcCkuY3NzKHtoZWlnaHQ6IF90Lmh9KTtcbiAgICAkKF90LnRhcmdldC5hcmVhRWRpdCkuY3NzKHtoZWlnaHQ6IF90LmFyZWEuZWRpdEh9KTtcblxuICAgICQuZ2V0SlNPTihDbW4uZGlyICsgJy9kYXRhL3NldHRpbmdzLmpzb24nLCAoanNvbik9PiB7XG4gICAgICBfdC5zZXR0aW5ncyA9IGpzb247XG4gICAgfSkuZG9uZSgoKT0+IHtcbiAgICAgIC8vIOODnuODg+ODl+OBruaPj+WGmVxuICAgICAgdmFyIGRpdiA9ICQoX3QudGFyZ2V0LmFyZWFNYXApLmdldCgwKTtcbiAgICAgIF90LmFyZWFNYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRpdiwgX3QubWFwT3B0aW9uKTtcblxuICAgICAgLy8g54++5Zyo5Zyw44Gu5Y+W5b6XXG4gICAgICBfdC5nZXRNeVBvc2l0aW9uKCdsb2FkJyk7XG4gICAgfSk7XG5cblxuICAgIC8vIEVkaXTjg5zjgr/jg7PmirzkuItcbiAgICAkKF90LnRhcmdldC5idG5FZGl0KS5vbigndG91Y2hlbmQnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgdmFyIGlzQ2xvc2UgPSAkKHRoaXMpLmhhc0NsYXNzKF90LmNscy5lZGl0KTtcblxuICAgICAgJChfdC50YXJnZXQuZm9ybSkucmVtb3ZlQ2xhc3MoJ2VkaXRXcml0ZScpLmFkZENsYXNzKCduZXdXcml0ZScpO1xuXG4gICAgICBpZiAoaXNDbG9zZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgX3Qub3BlbkJ0bigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3QuY2xvc2VCdG4oKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICB9XG5cbiAgLyoqXG4gICAqIOePvuWcqOWcsOOBruims+a4rFxuICAgKi9cbiAgZ2V0TXlQb3NpdGlvbihtb2RlID0gbnVsbCk6dm9pZCB7XG5cbiAgICB2YXIgX3QgPSB0aGlzLFxuICAgICAgZXJyb3JDb3VudCA9IDA7XG5cbiAgICBfdC5teVBvc2l0aW9uID0gd2luZG93Lm5hdmlnYXRvci5nZW9sb2NhdGlvbi53YXRjaFBvc2l0aW9uKHBvc2l0aW9uU3VjY2VzcywgcG9zaXRpb25FcnJvciwge1xuICAgICAgZW5hYmxlSGlnaEFjY3VyYWN5OiB0cnVlLFxuICAgICAgbWF4aW11bUFnZSAgICAgICAgOiAzMDAwMCxcbiAgICAgIHRpbWVvdXQgICAgICAgICAgIDogMjcwMDBcbiAgICB9KTtcblxuICAgIC8qKlxuICAgICAqIOS9jee9ruaDheWgseOBruaIkOWKn1xuICAgICAqIEBwYXJhbSBnZW9cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBwb3NpdGlvblN1Y2Nlc3MoZ2VvOmFueSk6dm9pZCB7XG4gICAgICBlcnJvckNvdW50ID0gMDtcbiAgICAgIF90Lm15R2VvID0gZ2VvO1xuXG4gICAgICAvLyDjg57jg7zjgqvjg7zjga7jgrvjg4Pjg4hcbiAgICAgIHZhciBjdXJyZW50UG9zaXRpb24gPSBuZXcgZ29vZ2xlLm1hcHMuTGF0TG5nKGdlby5jb29yZHMubGF0aXR1ZGUsIGdlby5jb29yZHMubG9uZ2l0dWRlKSxcbiAgICAgICAgaWNvbiA9IHtcbiAgICAgICAgICBwYXRoICAgICAgICAgOiBnb29nbGUubWFwcy5TeW1ib2xQYXRoLkNJUkNMRSxcbiAgICAgICAgICBzY2FsZSAgICAgICAgOiA2LFxuICAgICAgICAgIGZpbGxDb2xvciAgICA6IF90LnNldHRpbmdzLnN1YkNvbG9yLFxuICAgICAgICAgIGZpbGxPcGFjaXR5ICA6IDEsXG4gICAgICAgICAgc3Ryb2tlQ29sb3IgIDogJyNmZmZmZmYnLFxuICAgICAgICAgIHN0cm9rZU9wYWNpdHk6IDEsXG4gICAgICAgICAgc3Ryb2tlV2VpZ2h0IDogMVxuICAgICAgICB9O1xuXG4gICAgICBpZiAoX3QubXlNYXJrZXIgPT09IHZvaWQgMCkge1xuICAgICAgICBfdC5teU1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgICAgIGljb246IGljb24sXG4gICAgICAgICAgbWFwIDogX3QuYXJlYU1hcFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8g6Kqk5beu44K144O844Kv44Or44Gu44K744OD44OIXG4gICAgICBpZiAoX3QubXlEaWZmQ2lyY2xlID09PSB2b2lkIDApIHtcbiAgICAgICAgX3QubXlEaWZmQ2lyY2xlID0gbmV3IGdvb2dsZS5tYXBzLkNpcmNsZSh7XG4gICAgICAgICAgY2VudGVyICAgICAgIDogY3VycmVudFBvc2l0aW9uLFxuICAgICAgICAgIHJhZGl1cyAgICAgICA6IGdlby5jb29yZHMuYWNjdXJhY3ksXG4gICAgICAgICAgc3Ryb2tlQ29sb3IgIDogX3Quc2V0dGluZ3MubWFpbkNvbG9yLFxuICAgICAgICAgIHN0cm9rZU9wYWNpdHk6IDAuOCxcbiAgICAgICAgICBzdHJva2VXZWlnaHQgOiAxLFxuICAgICAgICAgIGZpbGxDb2xvciAgICA6IF90LnNldHRpbmdzLm1haW5Db2xvcixcbiAgICAgICAgICBmaWxsT3BhY2l0eSAgOiAwLjIsXG4gICAgICAgICAgbWFwICAgICAgICAgIDogX3QuYXJlYU1hcFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIF90Lm15RGlmZkNpcmNsZS5zZXRDZW50ZXIoY3VycmVudFBvc2l0aW9uKTtcbiAgICAgICAgX3QubXlEaWZmQ2lyY2xlLnNldFJhZGl1cyhnZW8uY29vcmRzLmFjY3VyYWN5KTtcbiAgICAgIH1cblxuICAgICAgX3QubXlNYXJrZXIuc2V0UG9zaXRpb24oY3VycmVudFBvc2l0aW9uKTtcblxuICAgICAgdmFyIGlzTSA9IF90Lm15TWFya2VyLmdldFZpc2libGUoKSxcbiAgICAgICAgaXNDID0gX3QubXlEaWZmQ2lyY2xlLmdldFZpc2libGUoKTtcblxuICAgICAgaWYgKGlzTSA9PT0gZmFsc2UpIF90Lm15TWFya2VyLnNldFZpc2libGUodHJ1ZSk7XG4gICAgICBpZiAoaXNDID09PSBmYWxzZSkgX3QubXlEaWZmQ2lyY2xlLnNldFZpc2libGUodHJ1ZSk7XG5cbiAgICAgIGlmIChfdC5mbGcuZWRpdCA9PT0gdHJ1ZSkge1xuICAgICAgICBfdC5teU1hcmtlci5zZXRWaXNpYmxlKGZhbHNlKTtcbiAgICAgICAgX3QubXlEaWZmQ2lyY2xlLnNldFZpc2libGUoZmFsc2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX3QuYXJlYU1hcC5wYW5UbyhjdXJyZW50UG9zaXRpb24pO1xuICAgICAgfVxuXG5cbiAgICAgIGlmKG1vZGUgPT09ICdsb2FkJyl7XG4gICAgICAgICQoJyNtZXNzYWdlJykucmVtb3ZlQ2xhc3MoJ3Nob3cnKTtcbiAgICAgICAgJCgnI21lc2FnZS10ZXh0JykuaHRtbCgnJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIDPliIbmr47jgavnj77lnKjlnLDjgpJEQuOBq+agvOe0jVxuICAgICAgaWYgKF90LmZsZy5yb290ID09PSB0cnVlKSB7XG4gICAgICAgIF90LmZsZy5yb290ID0gZmFsc2U7XG4gICAgICAgIHNldFRpbWVvdXQoKCk9PiB7XG4gICAgICAgICAgX3QuZmxnLnJvb3QgPSB0cnVlO1xuICAgICAgICAgIHZhciB0ZWFtID0gJCgnI2Zvcm1fdGVhbScpLnZhbCgpLFxuICAgICAgICAgICAgbGF0ID0gX3QubXlHZW8uY29vcmRzLmxhdGl0dWRlLFxuICAgICAgICAgICAgbG5nID0gX3QubXlHZW8uY29vcmRzLmxvbmdpdHVkZTtcblxuICAgICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmwgICAgIDogQ21uLmRpciArICcvcm9vdCcsXG4gICAgICAgICAgICB0eXBlICAgIDogJ1BPU1QnLFxuICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcbiAgICAgICAgICAgIGRhdGEgICAgOiB7XG4gICAgICAgICAgICAgIHRlYW06IHRlYW0sXG4gICAgICAgICAgICAgIGxhdCA6IGxhdCxcbiAgICAgICAgICAgICAgbG5nIDogbG5nXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2VzcyA6IChyZXMpPT4ge1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yICAgOiAoKT0+IHtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb21wbGV0ZTogKCk9PiB7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0sIDE4MDAwMCk7IC8vIDEwMDBtcyAqIDYwc2VjICogM+WIhiA9IDE4MDAwMFxuICAgICAgfVxuXG4gICAgfVxuXG4gICAgLyoqXG4gICAgICog5Y+W5b6X44Ko44Op44O8KDPlm57pgKPntprjga7loLTlkIjnlLvpnaLjg63jg4Pjgq8pXG4gICAgICogQHBhcmFtIGVycm9yXG4gICAgICovXG4gICAgZnVuY3Rpb24gcG9zaXRpb25FcnJvcihlcnJvcjphbnkpOnZvaWQge1xuICAgICAgZXJyb3JDb3VudCsrO1xuICAgICAgY29uc29sZS5sb2coZXJyb3IsIGVycm9yQ291bnQpO1xuICAgICAgX3QuZmxnLmRyYWcgPSBmYWxzZTtcblxuICAgICAgc3dpdGNoICh0cnVlKSB7XG4gICAgICAgIGNhc2UgKGVycm9yQ291bnQgPiAzKTpcbiAgICAgICAgICAvLyBUT0RPOiDkvb/jgYjjgarjgYTml6hcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAvLyDopo/lrprjgqjjg6njg7zlm57mlbDku6XlhoXjga7loLTlkIjjga/lho3luqblj5blvpfjgavjg4Hjg6Pjg6zjg7PjgrhcbiAgICAgICAgICBfdC5nZXRNeVBvc2l0aW9uKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gIH1cblxuICAvKipcbiAgICog6Kaz5ris44KS5YGc5q2iXG4gICAqL1xuICBjbGVhclBvc2l0aW9uKCk6dm9pZCB7XG4gICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmNsZWFyV2F0Y2godGhpcy5teVBvc2l0aW9uKTtcblxuICAgIHRoaXMubXlNYXJrZXIuc2V0VmlzaWJsZShmYWxzZSk7XG4gICAgdGhpcy5teURpZmZDaXJjbGUuc2V0VmlzaWJsZShmYWxzZSk7XG4gIH1cblxuICAvKipcbiAgICog55m76Yyy44O757eo6ZuG55S76Z2i44KS6KGo56S6XG4gICAqIEBwYXJhbSBsdGxuXG4gICAqL1xuICBvcGVuQnRuKGx0bG4gPSBbXSk6dm9pZCB7XG4gICAgJCh0aGlzLnRhcmdldC5hcmVhTWFwKS5jc3Moe2hlaWdodDogdGhpcy5hcmVhLm1hcEh9KTtcblxuICAgIHRoaXMuY2xlYXJQb3NpdGlvbigpO1xuXG4gICAgLy8g44OV44Kp44O844Og44Ko44Oq44Ki44Gu5pmC44Gv44OV44Op44Kw44KS56uL44Gm44KLXG4gICAgdGhpcy5mbGcuZWRpdCA9IHRydWU7XG4gICAgdGhpcy5mbGcuZHJhZyA9IGZhbHNlO1xuXG4gICAgJCh0aGlzLnRhcmdldC5idG5FZGl0KS5hZGRDbGFzcyh0aGlzLmNscy5lZGl0KTtcbiAgICB0aGlzLmVkaXRNYXBwaW5nKGx0bG4pO1xuICB9XG5cbiAgLyoqXG4gICAqIOeZu+mMsuODu+e3qOmbhueUu+mdouOCkumdnuihqOekulxuICAgKi9cbiAgY2xvc2VCdG4oKTp2b2lkIHtcbiAgICAkKHRoaXMudGFyZ2V0LmFyZWFNYXApLmNzcyh7aGVpZ2h0OiB0aGlzLmh9KTtcbiAgICAkKHRoaXMudGFyZ2V0LmJ0bkVkaXQpLnJlbW92ZUNsYXNzKHRoaXMuY2xzLmVkaXQpO1xuICAgIFJlZ2lzdGVyLnJlbW92ZUZvcm0oKTtcblxuICAgIC8vIOODnuODvOOCq+ODvOWJiumZpFxuICAgIGlmICh0aGlzLmVkaXRNYXJrZXIgIT09IHZvaWQgMCkge1xuICAgICAgZ29vZ2xlLm1hcHMuZXZlbnQuY2xlYXJMaXN0ZW5lcnModGhpcy5lZGl0TWFya2VyLCAnZHJhZ2VuZCcpO1xuICAgICAgdGhpcy5lZGl0TWFya2VyLnNldE1hcChudWxsKTtcbiAgICB9XG5cbiAgICAvLyDjg5Xjg6njgrDjga7jgrvjg4Pjg4hcbiAgICB0aGlzLmZsZy5lZGl0ID0gZmFsc2U7XG4gICAgdGhpcy5mbGcuZHJhZyA9IHRydWU7XG5cbiAgICAvLyDlho3mj4/lhplcbiAgICB2YXIgbGF0bG5nID0gdGhpcy5nZXRMYXRMbmcoKTtcbiAgICB0aGlzLnJlc2l6ZU1hcChsYXRsbmcpO1xuICAgIHRoaXMuZ2V0TXlQb3NpdGlvbigpO1xuICB9XG5cbiAgLyoqXG4gICAqIOOCouODi+ODoeODvOOCt+ODp+ODs+OBjOe1guS6huOBl+OBn+OCieODnuODg+ODl+OBruS9jee9ruOCkuiqv+aVtFxuICAgKiBAcGFyYW0gbGF0bG5nXG4gICAqL1xuICByZXNpemVNYXAobGF0bG5nKTp2b2lkIHtcbiAgICAkKHRoaXMudGFyZ2V0LmFyZWFNYXApLm9uKEVWRU5UUy5hbmltYXRpb24uZW5kLCAoKT0+IHtcbiAgICAgIGdvb2dsZS5tYXBzLmV2ZW50LnRyaWdnZXIodGhpcy5hcmVhTWFwLCAncmVzaXplJyk7XG4gICAgICB0aGlzLmFyZWFNYXAuc2V0Q2VudGVyKGxhdGxuZy5wb3MpO1xuICAgICAgJCh0aGlzLnRhcmdldC5hcmVhTWFwKS5vZmYoRVZFTlRTLmFuaW1hdGlvbi5lbmQpO1xuICAgIH0pO1xuICB9XG5cblxuICAvKipcbiAgICog5L2N572u5oOF5aCx44KS6L+U44GZXG4gICAqIEBwYXJhbSBsdGxuXG4gICAqIEByZXR1cm5zIHtnb29nbGUubWFwcy5MYXRMbmd9XG4gICAqL1xuICBnZXRMYXRMbmcobHRsbiA9IFtdKSB7XG4gICAgdmFyIGxhdCA9IChsdGxuWzBdID09PSB2b2lkIDApID8gdGhpcy5teUdlby5jb29yZHMubGF0aXR1ZGUgOiBsdGxuWzBdLFxuICAgICAgbG5nID0gKGx0bG5bMV0gPT09IHZvaWQgMCkgPyB0aGlzLm15R2VvLmNvb3Jkcy5sb25naXR1ZGUgOiBsdGxuWzFdO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGxhdDogbGF0LFxuICAgICAgbG5nOiBsbmcsXG4gICAgICBwb3M6IG5ldyBnb29nbGUubWFwcy5MYXRMbmcobGF0LCBsbmcpXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiDnmbvpjLLjg7vnt6jpm4bnlLvpnaLjgafjga7jg5Tjg7PkvY3nva5cbiAgICogQHBhcmFtIGx0bG5cbiAgICovXG4gIGVkaXRNYXBwaW5nKGx0bG4pOnZvaWQge1xuICAgIHZhciBsYXRsbmcgPSB0aGlzLmdldExhdExuZyhsdGxuKTtcblxuICAgIHRoaXMuZWRpdE1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xuICAgICAgcG9zaXRpb24gOiBsYXRsbmcucG9zLFxuICAgICAgZHJhZ2dhYmxlOiB0cnVlLFxuICAgICAgbWFwICAgICAgOiB0aGlzLmFyZWFNYXBcbiAgICB9KTtcblxuXG4gICAgLy8g44Oe44O844Kr44O844KS5YuV44GL44GX44Gf5aC05ZCI44Gv5bqn5qiZ44KS44K744OD44OIXG4gICAgZ29vZ2xlLm1hcHMuZXZlbnQuYWRkTGlzdGVuZXIodGhpcy5lZGl0TWFya2VyLCAnZHJhZ2VuZCcsIChldnQpPT4ge1xuICAgICAgdmFyIGxhdCA9IGV2dC5sYXRMbmcubGF0KCksXG4gICAgICAgIGxuZyA9IGV2dC5sYXRMbmcubG5nKCk7XG5cbiAgICAgICQodGhpcy5mb3JtLmxhdCkudmFsKGxhdCk7XG4gICAgICAkKHRoaXMuZm9ybS5sbmcpLnZhbChsbmcpO1xuICAgICAgJCh0aGlzLmZvcm0uZ2VvRmxnKS52YWwoJ3RydWUnKTtcbiAgICB9KTtcblxuICAgIC8vdGhpcy5hcmVhTWFwLnBhblRvKGxhdGxuZy5wb3MpO1xuICAgIHRoaXMucmVzaXplTWFwKGxhdGxuZyk7XG5cbiAgICAkKHRoaXMuZm9ybS5sYXQpLnZhbChsYXRsbmcubGF0KTtcbiAgICAkKHRoaXMuZm9ybS5sbmcpLnZhbChsYXRsbmcubG5nKTtcbiAgfVxufVxuXG52YXIgTWFwcztcbmpRdWVyeShmdW5jdGlvbiAoJCkge1xuICBNYXBzID0gbmV3IE1hcHBpbmcoKTtcbn0pO1xuXG4iXX0=